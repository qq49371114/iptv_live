# organize_live.yml v7.3
# 机器人管家：自动整理直播源 (霸道总裁版)
# 作者：婉儿 & 哥哥

name: 自动整理直播源

on:
  workflow_dispatch: # 允许手动触发
  schedule:
    - cron: '0 3,11,19 * * *' # ✨ 按照我们之前讨论的，每天3次，更及时！

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 设置Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install aiohttp tqdm # ✨ 把我们需要的 tqdm 也加上！

      - name: 运行整理程序
        run: |
          python -u m3u8_organizer.py \
          --config "config.json" \
          --rules-dir "rules" \
          --manual-sources-dir "sources_manual" \
          --generated-sources-dir "sources_generated" \
          --remote-sources-file "sources.txt" \
          -b "config/blacklist.txt" \
          -f "config/favorites.txt" \
          -o "dist/live"

      - name: 提交更新的文件
        uses: EndBug/add-and-commit@v9
        with:
          token: ${{ secrets.ACTIONS_PAT }} 
          add: 'dist/ sources_generated/'
          author_name: 'Waner-Bot'
          author_email: 'waner-bot@users.noreply.github.com'
          message: 'chore(bot): 自动更新直播源 (v7.3)'
          # --- ✨✨✨ 加上这两个“霸道”参数！✨✨✨ ---
          rebase: 'true'
          force: 'true'

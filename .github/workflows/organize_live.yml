# organize_live.yml v4.5
# 机器人管家：自动整理直播源 (清爽重构版)
# 作者：婉儿 & 哥哥

name: 自动整理直播源

on:
  workflow_dispatch: # 允许手动触发
  schedule:
    - cron: '0 0 * * *' # 每天北京时间早上8点运行

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 设置Python 3.10
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install aiohttp

      - name: 运行整理程序 (v4.5 新版调用方式)
        run: |
          python -u m3u8_organizer.py \
            --local-sources-dir "sources" \
            --remote-sources-file "sources.txt" \
            --epg-url "http://epg.51zmt.top:8000/e.xml.gz" \
            -b "config/blacklist.txt" \
            -f "config/favorites.txt" \
            -o "dist/live"

      - name: 提交更新的文件
        uses: EndBug/add-and-commit@v9
        with:
          # 使用 PAT, 确保有权限触发其他工作流 (如果需要的话)
          token: ${{ secrets.ACTIONS_PAT }} 
          # 只提交 dist 目录下的变动
          add: 'dist'
          # 提交作者信息
          author_name: 'Waner-Bot'
          author_email: 'waner-bot@users.noreply.github.com'
          # 提交信息
          message: 'chore: 自动更新直播源'
